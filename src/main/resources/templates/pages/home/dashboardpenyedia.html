<!DOCTYPE html>
<html lang="en"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{layout/master}">
<head>
    <title>Dashboard Penyedia</title>

</head>

<th:block layout:fragment="content">

    <div class="container-fluid mt-4">
        <!-- Dropdown Pilihan PT Penyedia -->
        <div class="mb-4">
            <label for="selectPenyedia" class="form-label fw-bold">Pilih Penyedia:</label>
            <select id="selectPenyedia" class="form-select">
                <option value="PT Maju Jaya">PT Maju Jaya</option>
                <option value="PT Sinar Terang">PT Sinar Terang</option>
                <option value="PT Cipta Mandiri">PT Cipta Mandiri</option>
            </select>
        </div>

        <div class="row">

            <!-- Legalitas -->
            <div class="col-md-6 mb-4">
                <div class="card shadow-sm">
                    <div class="card-header">
                        <strong>Status Legalitas Penyedia</strong>
                    </div>
                    <div class="card-body">
                        <div id="chartLegalitasBar"></div>
                    </div>
                </div>
            </div>

            <!-- Riwayat Pengadaan -->
            <div class="col-md-6 mb-4">
                <div class="card shadow-sm">
                    <div class="card-header">
                        <strong>Riwayat Pengadaan yang Pernah Diikuti</strong>
                    </div>
                    <div class="card-body">
                        <div id="chartRiwayatColumn"></div>
                    </div>
                </div>
            </div>

            <!-- Performance Record -->
            <div class="col-md-12 mb-4">
                <div class="card shadow-sm">
                    <div class="card-header">
                        <strong>Catatan Kinerja Penyedia (Performance Record)</strong>
                    </div>
                    <div class="card-body">
                        <div id="chartPerformanceRadial"></div>
                    </div>
                </div>
            </div>

        </div>
    </div>

</th:block>


<th:block layout:fragment="page_js">

    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

    <script>

        // ==================================================
        // DUMMY DATA SEMUA PENYEDIA (bisa diganti dari DB)
        // ==================================================

        var dataPenyedia = {
            "PT Maju Jaya": {
                legalitas: [100, 90, 85, 80],
                riwayat: [5, 6, 3, 10, 7],
                performance: [90, 85, 80, 88, 92]
            },
            "PT Sinar Terang": {
                legalitas: [90, 100, 95, 88],
                riwayat: [4, 8, 6, 12, 9],
                performance: [85, 90, 82, 84, 89]
            },
            "PT Cipta Mandiri": {
                legalitas: [80, 70, 75, 60],
                riwayat: [2, 3, 5, 4, 6],
                performance: [70, 75, 65, 72, 68]
            }
        };

        // ==================================================
        // 1. LEGALITAS – Horizontal Bar
        // ==================================================

        var legalitasChart = new ApexCharts(document.querySelector("#chartLegalitasBar"), {
            chart: { type: 'bar', height: 300 },
            plotOptions: {
                bar: { horizontal: true, distributed: true }
            },
            dataLabels: { enabled: true, formatter: v => v + "%" },
            series: [{ data: [] }],
            xaxis: {
                categories: ['SIUP', 'NIB', 'Akta', 'KBLI']
            },
            colors: ['#1E90FF', '#00B894', '#F39C12', '#6C5CE7']
        });

        legalitasChart.render();

        // ==================================================
        // 2. Riwayat Pengadaan – Column Chart
        // ==================================================

        var riwayatChart = new ApexCharts(document.querySelector("#chartRiwayatColumn"), {
            chart: { type: 'bar', height: 300 },
            series: [{ data: [] }],
            xaxis: { categories: ['2020', '2021', '2022', '2023', '2024'] },
            colors: ['#0984E3']
        });

        riwayatChart.render();

        // ==================================================
        // 3. Performance Record – Radial Multi Chart
        // ==================================================

        var performanceChart = new ApexCharts(document.querySelector("#chartPerformanceRadial"), {
            chart: { type: 'radialBar', height: 350 },
            series: [],
            labels: [
                'Kualitas',
                'Ketepatan Waktu',
                'Komitmen',
                'Komunikasi',
                'Kepatuhan'
            ],
            colors: ['#00B894', '#6C5CE7', '#F39C12', '#0984E3', '#E17055']
        });

        performanceChart.render();

        // ==================================================
        // FUNGSI UPDATE SEMUA CHART
        // ==================================================
        function updateDashboard(pt) {
            var d = dataPenyedia[pt];

            legalitasChart.updateSeries([{ data: d.legalitas }]);
            riwayatChart.updateSeries([{ data: d.riwayat }]);
            performanceChart.updateSeries(d.performance);
        }

        // Default load penyedia pertama
        updateDashboard("PT Maju Jaya");

        // ==================================================
        // EVENT PADA SELECT CHANGE
        // ==================================================
        document.getElementById("selectPenyedia").addEventListener("change", function() {
            updateDashboard(this.value);
        });

    </script>

</th:block>



</html>